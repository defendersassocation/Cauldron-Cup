<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Registration - Cauldron Cup 2025</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <h1>üéÉ Cauldron Cup 2025 ü¶á</h1>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="register.html">Register</a></li>
                <li><a href="sponsors.html">Sponsors</a></li>
                <li><a href="scoreboard.html">Scoreboard</a></li>
                <li><a href="teetimes.html">Tee Times</a></li>
            </ul>
        </nav>
    </header>
    
    <main>
        <div class="container">
            <div class="registration-header">
                <h1>Individual Player Registration</h1>
                <p class="registration-subtitle">Register as an individual player - $85 per person</p>
            </div>

            <div class="registration-options">
                <button class="btn btn-primary" onclick="showExistingTeam()">
                    <span class="btn-icon">üë•</span>
                    Join Existing Team
                </button>
                <button class="btn btn-secondary" onclick="showNewTeam()">
                    <span class="btn-icon">‚≠ê</span>
                    Create New Team
                </button>
            </div>

            <!-- Search Existing Team -->
            <div id="existing-team-search" class="form-section" style="display: none;">
                <h2>üîç Find Your Team</h2>
                <div class="search-container">
                    <div class="form-group">
                        <input type="text" id="teamSearch" placeholder="Enter team name to search...">
                        <button onclick="searchTeam()" class="btn btn-primary">Search Teams</button>
                    </div>
                </div>
                <div id="teamSearchResults" class="search-results"></div>
            </div>

            <!-- Individual Player Registration -->
            <div id="new-team-form" class="form-section" style="display: none;">
                <h2 id="form-title">‚ö° Player Registration</h2>
                <p class="form-description" id="form-description">Register as an individual player. If your team doesn't exist, you'll create it!</p>
                
                <form id="playerRegistrationForm">
                    <!-- Player Information -->
                    <div class="section-header">
                        <h3>üë§ Your Information</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="playerName">Full Name *</label>
                            <input type="text" id="playerName" required placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label for="playerEmail">Email Address *</label>
                            <input type="email" id="playerEmail" required placeholder="your.email@example.com">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="playerPhone">Phone Number *</label>
                        <input type="tel" id="playerPhone" required placeholder="(555) 123-4567">
                    </div>

                    <!-- Team Information -->
                    <div class="section-header">
                        <h3>üèåÔ∏è Team Information</h3>
                    </div>
                    
                    <div class="form-group">
                        <label for="teamName">Team Name *</label>
                        <input type="text" id="teamName" required placeholder="Enter your team name">
                        <div id="teamNameStatus" class="team-status-message"></div>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-container">
                            <label class="checkbox-label">
                                <input type="checkbox" id="isTeamCaptain">
                                <span class="checkmark"></span>
                                I am the team captain
                            </label>
                            <small class="help-text">Check this if you're organizing this team</small>
                        </div>
                    </div>

                    <!-- Individual Add-Ons -->
                    <div class="section-header">
                        <h3>üõçÔ∏è Personal Add-Ons</h3>
                    </div>
                    
                    <div class="addon-grid">
                        <div class="addon-card">
                            <label class="addon-label">
                                <input type="checkbox" id="personalMulligan" onchange="updateIndividualTotal()">
                                <div class="addon-content">
                                    <div class="addon-title">Mulligan Bag</div>
                                    <div class="addon-price">$10</div>
                                    <div class="addon-description">Extra chances for those tricky shots</div>
                                </div>
                            </label>
                        </div>
                        
                        <div class="addon-card">
                            <label class="addon-label">
                                <input type="checkbox" id="personalPuttingString" onchange="updateIndividualTotal()">
                                <div class="addon-content">
                                    <div class="addon-title">12" Putting String</div>
                                    <div class="addon-price">$5</div>
                                    <div class="addon-description">Gimme putts within 12 inches</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Total Section -->
                    <div class="total-card">
                        <div class="total-breakdown">
                            <div class="total-line">
                                <span>Registration Fee:</span>
                                <span>$85</span>
                            </div>
                            <div class="total-line addon-line" id="mulligan-line" style="display: none;">
                                <span>Mulligan Bag:</span>
                                <span>$10</span>
                            </div>
                            <div class="total-line addon-line" id="string-line" style="display: none;">
                                <span>Putting String:</span>
                                <span>$5</span>
                            </div>
                            <div class="total-final">
                                <span>Your Total:</span>
                                <span class="total-amount">$<span id="individualTotal">85</span></span>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-large">
                        üéØ Register & Pay $<span id="button-total">85</span>
                    </button>
                </form>
            </div>

            <!-- Payment Section -->
            <div id="payment-section" class="form-section" style="display: none;">
                <h2>üí≥ Complete Your Registration</h2>
                <div id="payment-summary" class="payment-summary"></div>
                
                <div class="payment-demo">
                    <h3>Demo Payment Mode</h3>
                    <p>This is a demonstration. No actual payment will be processed.</p>
                    <button id="submit-payment" class="btn btn-primary btn-large">
                        ‚úÖ Complete Registration (Demo)
                    </button>
                </div>
                
                <button onclick="goBackToForm()" class="btn btn-outline">‚Üê Back to Registration Form</button>
                <div id="payment-messages" class="message-container"></div>
            </div>
        </div>
    </main>
    
    <footer>
        <div class="container">
            <p>&copy; 2025 Defender's Association</p>
        </div>
    </footer>

    <script>
        // Global variables
        let currentRegistrationType = 'new';

        // Main functions
        function showExistingTeam() {
            currentRegistrationType = 'existing';
            document.getElementById('existing-team-search').style.display = 'block';
            document.getElementById('new-team-form').style.display = 'none';
            document.getElementById('payment-section').style.display = 'none';
            updateButtonStates('existing');
        }

        function showNewTeam() {
            currentRegistrationType = 'new';
            document.getElementById('existing-team-search').style.display = 'none';
            document.getElementById('new-team-form').style.display = 'block';
            document.getElementById('payment-section').style.display = 'none';
            updateButtonStates('new');
            resetForm();
        }

        function updateButtonStates(activeType) {
            const buttons = document.querySelectorAll('.registration-options button');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (activeType === 'existing') {
                buttons[0].classList.add('active');
            } else {
                buttons[1].classList.add('active');
            }
        }

        function resetForm() {
            document.getElementById('form-title').textContent = '‚ö° Player Registration';
            document.getElementById('form-description').textContent = "Register as an individual player. If your team doesn't exist, you'll create it!";
            document.getElementById('teamName').readOnly = false;
            document.getElementById('isTeamCaptain').disabled = false;
            document.getElementById('teamNameStatus').innerHTML = '';
            sessionStorage.removeItem('joiningTeamId');
        }

        function searchTeam() {
            const searchTerm = document.getElementById('teamSearch').value.toLowerCase().trim();
            const results = document.getElementById('teamSearchResults');
            
            if (!searchTerm) {
                results.innerHTML = '<div class="search-message">Please enter a team name to search.</div>';
                return;
            }

            const registeredTeams = JSON.parse(localStorage.getItem('registeredTeams')) || [];
            const foundTeams = registeredTeams.filter(team =>
                team.name.toLowerCase().includes(searchTerm)
            );

            if (foundTeams.length > 0) {
                results.innerHTML = '<h3>Found Teams:</h3>' +
                    foundTeams.map(team => {
                        const playerCount = team.players ? team.players.length : 0;
                        const spotsLeft = 4 - playerCount;
                        
                        return `
                            <div class="team-result-card">
                                <div class="team-info">
                                    <h4>${team.name}</h4>
                                    <p><strong>Captain:</strong> ${team.captain || 'TBD'}</p>
                                    <p><strong>Players:</strong> ${playerCount}/4</p>
                                    <p><strong>Spots Available:</strong> ${spotsLeft}</p>
                                </div>
                                <div class="team-actions">
                                    ${spotsLeft > 0 ? 
                                        `<button onclick="joinExistingTeam('${team.id}', '${team.name}')" class="btn btn-primary">
                                            Join Team - $85
                                        </button>` :
                                        `<span class="team-full-badge">Team Full</span>`
                                    }
                                </div>
                            </div>
                        `;
                    }).join('');
            } else {
                results.innerHTML = `
                    <div class="no-results-card">
                        <h3>No teams found</h3>
                        <p>No teams found matching "${searchTerm}".</p>
                        <p>Would you like to create a new team with this name?</p>
                        <button onclick="createTeamWithName('${searchTerm}')" class="btn btn-secondary">
                            Create "${searchTerm}" Team
                        </button>
                    </div>
                `;
            }
        }

        function joinExistingTeam(teamId, teamName) {
            showNewTeam();
            document.getElementById('teamName').value = teamName;
            document.getElementById('teamName').readOnly = true;
            document.getElementById('isTeamCaptain').checked = false;
            document.getElementById('isTeamCaptain').disabled = true;
            
            document.getElementById('form-title').textContent = `üë• Join Team: ${teamName}`;
            document.getElementById('form-description').textContent = `You're joining the existing team "${teamName}". Fill out your information below.`;
            
            sessionStorage.setItem('joiningTeamId', teamId);
        }

        function createTeamWithName(teamName) {
            showNewTeam();
            document.getElementById('teamName').value = teamName;
            document.getElementById('isTeamCaptain').checked = true;
            document.getElementById('form-title').textContent = '‚≠ê Create New Team';
            document.getElementById('form-description').textContent = `Creating team "${teamName}". You'll be the team captain!`;
        }

        function checkTeamStatus() {
            const teamName = document.getElementById('teamName').value.trim();
            const statusDiv = document.getElementById('teamNameStatus');
            const captainCheckbox = document.getElementById('isTeamCaptain');
            
            if (teamName.length === 0) {
                statusDiv.innerHTML = '';
                return;
            }

            if (document.getElementById('teamName').readOnly) {
                return; // Don't check if we're joining an existing team
            }

            const registeredTeams = JSON.parse(localStorage.getItem('registeredTeams')) || [];
            const existingTeam = registeredTeams.find(team =>
                team.name.toLowerCase() === teamName.toLowerCase()
            );

            if (existingTeam) {
                const playerCount = existingTeam.players ? existingTeam.players.length : 0;
                const spotsLeft = 4 - playerCount;
                
                if (spotsLeft > 0) {
                    statusDiv.innerHTML = `<div class="status-existing">‚úÖ Team exists (${spotsLeft} spots available)</div>`;
                    captainCheckbox.checked = false;
                    captainCheckbox.disabled = true;
                } else {
                    statusDiv.innerHTML = `<div class="status-full">‚ùå Team is full (4/4 players)</div>`;
                    captainCheckbox.disabled = true;
                }
            } else {
                statusDiv.innerHTML = `<div class="status-new">üÜï New team - you'll be the captain!</div>`;
                captainCheckbox.checked = true;
                captainCheckbox.disabled = false;
            }
        }

        function updateIndividualTotal() {
            let total = 85; // Base registration fee
            
            const mulliganChecked = document.getElementById('personalMulligan').checked;
            const stringChecked = document.getElementById('personalPuttingString').checked;
            
            if (mulliganChecked) {
                total += 10;
                document.getElementById('mulligan-line').style.display = 'flex';
            } else {
                document.getElementById('mulligan-line').style.display = 'none';
            }
            
            if (stringChecked) {
                total += 5;
                document.getElementById('string-line').style.display = 'flex';
            } else {
                document.getElementById('string-line').style.display = 'none';
            }
            
            document.getElementById('individualTotal').textContent = total;
            document.getElementById('button-total').textContent = total;
            
            return total;
        }

        function handlePlayerRegistration(e) {
            e.preventDefault();
            
            const playerData = {
                id: 'player_' + Date.now() +
